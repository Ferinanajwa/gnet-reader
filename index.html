
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GNet Reader Web</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    .box, .login-box {
      background: #fff; padding: 20px; border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-top: 50px;
    }
    input[type="file"], input[type="text"], input[type="password"] {
      width: 100%; padding: 10px; margin-bottom: 10px;
      border: 1px solid #ccc; border-radius: 5px;
    }
    button {
      padding: 10px 20px; background-color: #007bff;
      border: none; border-radius: 5px; color: white; cursor: pointer;
      margin-top: 10px; margin-right: 10px;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc; padding: 8px; text-align: center;
    }
    th { background: #007bff; color: white; }
    .badge {
      display: inline-block; padding: 6px 12px; border-radius: 5px;
      color: white; margin-top: 10px;
    }
    .good { background-color: #28a745; }
    .medium { background-color: #ffc107; color: black; }
    .bad { background-color: #dc3545; }
    .hidden { display: none; }
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        display: none;
      }
      td {
        border: none;
        border-bottom: 1px solid #ccc;
        position: relative;
        padding-left: 50%;
      }
      td::before {
        position: absolute;
        top: 8px;
        left: 10px;
        width: 45%;
        white-space: nowrap;
        font-weight: bold;
      }
      td:nth-of-type(1)::before { content: "Timestamp"; }
      td:nth-of-type(2)::before { content: "Operator"; }
      td:nth-of-type(3)::before { content: "RSSI"; }
      td:nth-of-type(4)::before { content: "RSRP"; }
      td:nth-of-type(5)::before { content: "RSRQ"; }
      td:nth-of-type(6)::before { content: "SINR"; }
      td:nth-of-type(7)::before { content: "Mode"; }
    }
    canvas {
      max-width: 100% !important;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <div class="login-box" id="loginBox">
      <h2>üîê Login GNet Reader</h2>
      <input type="text" id="username" placeholder="Masukkan nama kamu" />
      <input type="password" id="password" placeholder="Masukkan password" />
      <button onclick="login()">Masuk</button>
    </div>

    <div class="box hidden" id="mainApp">
      <h2>üì∂ GNet Reader Web</h2>
      <p>Halo, <span id="displayName"></span>! Upload file .txt hasil ekspor GNetTrack:</p>
      <input type="file" id="fileInput" accept=".txt" />
      <button onclick="exportToCSV()">üì§ Ekspor Tabel ke CSV</button>
      <div id="grade"></div>

      <table id="dataTable">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Operator</th>
            <th>RSSI</th>
            <th>RSRP</th>
            <th>RSRQ</th>
            <th>SINR</th>
            <th>Mode</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <h4>üìä Sintistik Sinyal:</h4>
      <div id="statistik"></div>
      <canvas id="chart" height="150"></canvas>
    </div>
  </div>

<script>
function login() {
  const user = document.getElementById("username").value.trim();
  const pass = document.getElementById("password").value.trim();
  if (pass !== "gnetreader123") {
    alert("Password salah!");
    return;
  }
  document.getElementById("displayName").textContent = user || "Pengguna";
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("mainApp").classList.remove("hidden");
}

document.getElementById('fileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const lines = e.target.result.split('\n').filter(line => line.trim() !== '');
    if (lines.length < 2) return alert('File tidak berisi data.');

    const headers = lines[0].split('\t');
    const indexMap = key => headers.findIndex(h => h.toLowerCase() === key.toLowerCase());

    const idx = {
      timestamp: indexMap("Timestamp"),
      operator: indexMap("Operatorname"),
      rssi: indexMap("Level"),
      rsrp: indexMap("LTERSSI"),
      rsrq: indexMap("Qual"),
      sinr: indexMap("SNR"),
      mode: indexMap("NetworkMode")
    };

    const tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    let sinrTotal = 0, sinrCount = 0, rsrqBest = null, rsrpMin = null;
    let sinrChart = [], rsrpChart = [], labelChart = [];

    for (let i = 1; i < lines.length; i++) {
      const cols = lines[i].split('\t');
      const get = name => (idx[name] !== -1 ? cols[idx[name]] : "N/A");

      const timestamp = get("timestamp");
      const operator = get("operator");
      const rssi = get("rssi");
      const rsrp = get("rsrp");
      const rsrq = get("rsrq");
      let sinr = get("sinr");
      const mode = get("mode");

      const rsrqNum = parseFloat(rsrq);
      const rsrpNum = parseFloat(rsrp);
      const sinrVal = parseFloat(sinr);

      if (!isNaN(rsrqNum)) {
        if (rsrqBest === null || rsrqNum > rsrqBest) rsrqBest = rsrqNum;
      }
      if (!isNaN(rsrpNum)) {
        if (rsrpMin === null || rsrpMin > rsrpNum) rsrpMin = rsrpNum;
        rsrpChart.push(rsrpNum);
      } else {
        rsrpChart.push(null);
      }

      if (!isNaN(sinrVal)) {
        sinrTotal += sinrVal;
        sinrCount++;
        sinrChart.push(sinrVal);
        sinr = sinrVal + ' dB';
      } else {
        sinrChart.push(null);
        sinr = "N/A";
      }

      labelChart.push(timestamp.substring(11, 16));

      const row = document.createElement('tr');
      [timestamp, operator, rssi, rsrp, rsrq, sinr, mode].forEach(val => {
        const td = document.createElement('td');
        td.textContent = val;
        row.appendChild(td);
      });
      tbody.appendChild(row);
    }

    document.getElementById("statistik").innerHTML = `
      <p><strong>SINR Rata-rata:</strong> ${(sinrTotal/sinrCount).toFixed(2)} dB</p>
      <p><strong>RSRP Terendah:</strong> ${rsrpMin} dBm</p>
      <p><strong>RSRQ Terbaik:</strong> ${rsrqBest} dB</p>
    `;

    let gradeText = "N/A", gradeClass = "";
    if (sinrTotal && rsrqBest !== null) {
      const avgSINR = sinrTotal / sinrCount;
      if (avgSINR >= 20 && rsrqBest >= -10) {
        gradeText = "Sinyal Baik"; gradeClass = "good";
      } else if (avgSINR >= 10 && rsrqBest >= -15) {
        gradeText = "Sinyal Sedang"; gradeClass = "medium";
      } else {
        gradeText = "Sinyal Buruk"; gradeClass = "bad";
      }
    }
    document.getElementById("grade").innerHTML = `<span class="badge ${gradeClass}">${gradeText}</span>`;

    const ctx = document.getElementById("chart").getContext("2d");
    if (window.gnetChart) window.gnetChart.destroy();
    window.gnetChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labelChart,
        datasets: [
          { label: 'SINR', data: sinrChart, borderColor: '#28a745', backgroundColor: 'rgba(40,167,69,0.1)', tension: 0.4 },
          { label: 'RSRP', data: rsrpChart, borderColor: '#007bff', backgroundColor: 'rgba(0,123,255,0.1)', tension: 0.4 }
        ]
      },
      options: { responsive: true, scales: { y: { beginAtZero: false } } }
    });
  };
  reader.readAsText(file);
});

function exportToCSV() {
  const rows = Array.from(document.querySelectorAll("#dataTable tr"));
  const csvContent = rows.map(row => 
    Array.from(row.querySelectorAll("th, td")).map(td => td.textContent).join(",")
  ).join("\n");
  const blob = new Blob([csvContent], { type: "text/csv" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "data_gnetreader.csv";
  link.click();
}
</script>
</body>
</html>
